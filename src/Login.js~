import { LoginDataContext } from './LoginDataContext';
import { useState, useContext } from 'react';
import { useHistory } from 'react-router-dom';

const Login = () => {

    const history = useHistory();
    const { loginData, setLoginData } = useContext(LoginDataContext);

    const [nameField, setNameField] = useState('');
    const [passwordField, setPasswordField] = useState('');

    const storage = window.localStorage;
    const userDatabase = JSON.parse(storage.getItem('user-database'));

    function handleSubmit(e) {
        e.preventDefault();

        for(let userIndex = 0; userIndex < userDatabase.length; userIndex++) {
            const user = userDatabase[userIndex];
            const nameCorrect = nameField.toUpperCase() === user.username.toUpperCase();
            const passwordCorrect = passwordField === user.password;

            if(nameCorrect && passwordCorrect) {
                setLoginData({
                    username: user.username,
                    logged: true
                });
                history.go(-1);
                break;
            }
        };
    }

    return (
        <form id="login-form" onSubmit={(e) => handleSubmit(e)}>

            <label htmlFor="username-field">Username</label>
            <input name="username-field" type="text" placeholder="Username"
                   value={nameField}
                   onChange={(e) => setNameField(e.target.value)}/>

            <label htmlFor="pswd-field">Password</label>
            <input name="pswd-field" type="text"  placeholder="Password" autoComplete="off"
                   value={passwordField}
                   onChange={(e) => setPasswordField(e.target.value)}/>

            <input type="submit" readOnly value="Submit"/>

        </form>
    );
};

export default Login;
